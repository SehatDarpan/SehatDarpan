<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jabalpur Health – Find Clinics & Hospitals</title>
  <meta name="description" content="Citizen-first directory for Jabalpur: verified clinics, hospitals, labs. Experience-based reviews (wait time, hygiene, cost transparency). No health data collected." />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b5fff">
  <link rel="icon" href="icons/icon-192.png" />

  <style>
    :root{
      --bg:#0b1020; --card:#111831; --muted:#9aa7be; --brand:#0b5fff; --ok:#27AE60; --ring:rgba(11,95,255,.28);
      --danger:#ef4444; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(180deg,#0b1020 0%,#0b1020 40%,#0f172a 100%);color:#e7eaf3;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
    a{color:#cfe1ff;text-decoration:none}
    header{position:sticky;top:0;background:rgba(11,16,32,.9);backdrop-filter:blur(8px);border-bottom:1px solid #1f2a4a;z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:12px 16px}
    .row{display:grid;gap:12px}
    .grid-3{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){ .grid-3{grid-template-columns:280px 1fr 1fr} }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#0b5fff, #27AE60)}
    .title{font-weight:700}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #1f2a4a;border-radius:999px;background:#111831}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    input,select,button{background:#0f172a;color:#e7eaf3;border:1px solid #1f2a4a;border-radius:10px;padding:10px 12px}
    input::placeholder{color:#9aa7be}
    button{cursor:pointer}
    .btn{background:linear-gradient(135deg,#0b5fff,#2563eb);border:none;box-shadow:0 6px 18px rgba(11,95,255,.25)}
    .btn-outline{background:transparent;border:1px dashed #27417a}
    main{padding:16px}
    .filters{border:1px solid #1f2a4a;background:#0d1429;border-radius:16px;padding:12px}
    .providers{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:760px){ .providers{grid-template-columns:1fr 1fr}}
    @media(min-width:1100px){ .providers{grid-template-columns:1fr 1fr 1fr}}
    .card{background:linear-gradient(180deg,#0f172a,#0d1429);border:1px solid #1f2a4a;border-radius:16px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .name{font-weight:700;font-size:1.05rem;margin:0 0 4px}
    .meta{color:#9aa7be;font-size:.9rem}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .badge{font-size:.75rem;border:1px solid #22335e;padding:4px 8px;border-radius:999px;background:#0e1a36}
    .badge.ok{border-color:#1b6b44;background:#0f2d23;color:#9ff3c1}
    .badge.warn{border-color:#5e4a22;background:#2a1f0b;color:#ffd69e}
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .tag{font-size:.72rem;border:1px solid #26365f;padding:3px 6px;border-radius:8px;color:#c9d7f0}
    .row-split{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:10px}
    .score{font-weight:700}
    .hint{font-size:.8rem;color:#9aa7be}
    .footer{opacity:.8;margin-top:24px}
    .empty{opacity:.7;padding:24px;text-align:center;border:1px dashed #27417a;border-radius:12px}
    .lang-toggle{display:flex;gap:6px}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #1f2a4a;background:#0f172a;cursor:pointer}
    .chip.active{background:#0b5fff;border-color:#0b5fff;color:#fff}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div class="title">Jabalpur Health</div>
          <div class="hint" id="subtitle">Citizen-first directory • No health data collected</div>
        </div>
      </div>

      <div class="controls">
        <input id="q" type="search" placeholder="Search (e.g., Pediatrician, Ranjhi, ₹200–500)" />
        <select id="specialty">
          <option value="">All specialties</option>
          <option>Pediatrics</option>
          <option>OBGYN</option>
          <option>General Medicine</option>
          <option>Pathology</option>
        </select>
        <select id="area">
          <option value="">All areas</option>
          <option>Napier Town</option>
          <option>Wright Town</option>
          <option>Ranjhi</option>
          <option>Medical College</option>
        </select>
        <select id="price">
          <option value="">Any fee</option>
          <option value="0-200">₹0–200</option>
          <option value="200-400">₹200–400</option>
          <option value="400-800">₹400–800</option>
        </select>
        <button class="btn" id="searchBtn">Search</button>
        <button class="btn-outline" id="clearBtn">Reset</button>
        <span class="pill"><span id="count">0</span> results</span>
        <div class="lang-toggle" title="Language">
          <div class="chip active" id="lang-en">EN</div>
          <div class="chip" id="lang-hi">हिं</div>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="filters hint" id="policy">
      <strong>Privacy note:</strong> We collect <em>experience-only</em> feedback (wait time, hygiene, courtesy, cost transparency). <u>No health details</u> like diagnosis or prescriptions.
    </section>

    <section class="providers" id="list"></section>

    <div class="footer hint">
      <p>Confidence-backed scores use the Wilson lower bound so clinics with very few reviews don’t unfairly outrank others.</p>
      <p>Want to claim your profile? <a href="#">Request access</a></p>
    </div>
  </main>

  <script>
    // --- i18n (very light) ---
    const strings = {
      en: {
        subtitle: "Citizen-first directory • No health data collected",
        privacy: "Privacy note: We collect experience-only feedback (wait time, hygiene, courtesy, cost transparency). No health details like diagnosis or prescriptions.",
        results: "results",
        claimed: "Claimed",
        govt: "Govt registry",
        geo: "Location verified",
        community: "Community verified",
        fee: "Fee band",
        call: "Call",
        dir: "Directions"
      },
      hi: {
        subtitle: "नागरिक-प्रथम निर्देशिका • कोई स्वास्थ्य विवरण एकत्र नहीं",
        privacy: "गोपनीयता: हम केवल अनुभव-आधारित फीडबैक लेते हैं (इंतज़ार समय, सफ़ाई, व्यवहार, खर्च की स्पष्टता)। बीमारी/दवा जैसी जानकारी नहीं लेते।",
        results: "परिणाम",
        claimed: "क्लेम्ड",
        govt: "सरकारी रजिस्ट्रि",
        geo: "स्थान सत्यापित",
        community: "समुदाय सत्यापित",
        fee: "फ़ीस रेंज",
        call: "कॉल",
        dir: "दिशाएँ"
      }
    };
    let lang = 'en';
    const t = (k)=> strings[lang][k];

    const elSubtitle = document.getElementById('subtitle');
    const elPolicy = document.getElementById('policy');
    const elCount = document.getElementById('count');
    const elList = document.getElementById('list');
    const q = document.getElementById('q');
    const specialty = document.getElementById('specialty');
    const area = document.getElementById('area');
    const price = document.getElementById('price');

    document.getElementById('lang-en').onclick = () => switchLang('en');
    document.getElementById('lang-hi').onclick = () => switchLang('hi');

    function switchLang(next){
      lang = next;
      document.getElementById('lang-en').classList.toggle('active', lang==='en');
      document.getElementById('lang-hi').classList.toggle('active', lang==='hi');
      elSubtitle.textContent = t('subtitle');
      elPolicy.innerHTML = `<strong>${lang==='en'?'Privacy note:':'गोपनीयता:'}</strong> ${t('privacy')}`;
      render();
    }

    // --- data load ---
    let providers = [];
    fetch('providers.json')
      .then(r => r.json())
      .then(d => { providers = d; render(); })
      .catch(_ => {
        // fallback: minimal inlined demo (same as your sample sheet)
        providers = [
          {"id":1,"name":"Netaji Subhash Chandra Bose Hospital","facility_type":"Hospital","specialties":["General Medicine","OBGYN","Pediatrics"],"address":"Medical College Campus, Garha Rd, Jabalpur","area":"Medical College","city":"Jabalpur","state":"Madhya Pradesh","pincode":"482003","phone":"0761-267xxxx","languages":["Hindi","English"],"fees_min":200,"fees_max":500,"badges":["govt","geo"]},
          {"id":2,"name":"Marble City Hospital","facility_type":"Hospital","specialties":["Pediatrics","General Medicine"],"address":"Napier Town, Jabalpur","area":"Napier Town","city":"Jabalpur","state":"Madhya Pradesh","pincode":"482001","phone":"0761-403xxxx","languages":["Hindi","English"],"fees_min":300,"fees_max":800,"badges":["community"]},
          {"id":3,"name":"Dr. Meena Sharma Clinic","facility_type":"Clinic","specialties":["OBGYN"],"address":"Wright Town, Jabalpur","area":"Wright Town","city":"Jabalpur","state":"Madhya Pradesh","pincode":"482002","phone":"98260xxxxx","languages":["Hindi"],"fees_min":250,"fees_max":400,"badges":["claimed","community"]},
          {"id":4,"name":"City Care Pathology Lab","facility_type":"Lab","specialties":["Pathology"],"address":"Ranjhi, Jabalpur","area":"Ranjhi","city":"Jabalpur","state":"Madhya Pradesh","pincode":"482005","phone":"93033xxxxx","languages":["Hindi","English"],"fees_min":150,"fees_max":300,"badges":["geo"]}
        ];
        render();
      });

    function searchFilter(p){
      const txt = q.value.trim().toLowerCase();
      const spec = specialty.value;
      const a = area.value;
      const pr = price.value;

      let ok = true;

      if (txt){
        const hay = (p.name+' '+p.facility_type+' '+p.address+' '+p.area+' '+(p.specialties||[]).join(' ')+' '+[p.fees_min,p.fees_max].join('-')).toLowerCase();
        ok = ok && hay.includes(txt);
      }
      if (spec) ok = ok && (p.specialties||[]).includes(spec);
      if (a) ok = ok && p.area===a;
      if (pr){
        const [lo,hi] = pr.split('-').map(Number);
        ok = ok && p.fees_min>=lo && p.fees_max<=hi;
      }
      return ok;
    }

    function badgeView(code){
      const map = {
        claimed: {label: t('claimed'), cls:'ok'},
        govt: {label: t('govt'), cls:'ok'},
        geo: {label: t('geo'), cls:'ok'},
        community: {label: t('community'), cls:'warn'},
      };
      const b = map[code] || {label: code, cls:''};
      return `<span class="badge ${b.cls}">${b.label}</span>`;
    }

    function render(){
      const out = providers.filter(searchFilter);
      elCount.textContent = out.length;

      if (!out.length){
        elList.innerHTML = `<div class="empty">No providers match your filters.</div>`;
        return;
      }

      elList.innerHTML = out.map(p => {
        const specs = (p.specialties||[]).map(s=>`<span class="tag">${s}</span>`).join('');
        const langs = (p.languages||[]).map(s=>`<span class="tag">${s}</span>`).join('');
        const badges = (p.badges||[]).map(badgeView).join('');
        return `
          <article class="card">
            <h3 class="name">${p.name}</h3>
            <div class="meta">${p.facility_type} • ${p.area}, ${p.city} – ${p.state} ${p.pincode}</div>
            <div class="badges">${badges}</div>
            <div class="tags">${specs} ${langs}</div>
            <div class="row-split">
              <div class="hint">${t('fee')}: ₹${p.fees_min}–${p.fees_max}</div>
              <div>
                <a class="pill" href="tel:${p.phone || ''}">📞 ${t('call')}</a>
                <a class="pill" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.address+', '+p.city)}" target="_blank">🧭 ${t('dir')}</a>
              </div>
            </div>
          </article>
        `;
      }).join('');
    }

    // search events
    document.getElementById('searchBtn').onclick = render;
    document.getElementById('clearBtn').onclick = ()=>{
      q.value = ''; specialty.value=''; area.value=''; price.value='';
      render();
    };

    // PWA: register service worker
    if ('serviceWorker' in navigator){
      window.addEventListener('load', ()=> navigator.serviceWorker.register('sw.js').catch(()=>{}));
    }
  </script>
</body>
</html>
